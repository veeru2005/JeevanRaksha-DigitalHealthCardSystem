{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "a08bdca6",
   "metadata": {},
   "source": [
    "# LifeLine AI - Clinical Decision Support System Test\n",
    "\n",
    "This notebook tests the complete medical safety pipeline:\n",
    "1. Load patient data from CSV files\n",
    "2. Use Hugging Face NER for medical entity extraction\n",
    "3. Apply rule-based safety checks\n",
    "4. Generate explainable alerts and risk assessment\n",
    "\n",
    "---\n",
    "\n",
    "## üìã How This Notebook Works:\n",
    "\n",
    "**Step 1 (Cells 1-3):** Load libraries, AI model, and patient data from CSV files\n",
    "\n",
    "**Step 2 (Cell 3.5):** See all patients - **RUN THIS FIRST to find which patient has complete data**\n",
    "\n",
    "**Step 3 (Cell 3.6 or 4):** Select a patient OR enter custom data\n",
    "\n",
    "**Step 4 (Cells 5-7):** AI extracts medical entities (diseases, drugs) from patient data\n",
    "\n",
    "**Step 5 (Cells 8-9):** Check safety rules against knowledge base CSVs\n",
    "\n",
    "**Step 6 (Cells 10-12):** Combine alerts, compute risk level, and explain results\n",
    "\n",
    "---\n",
    "\n",
    "## üéØ Which Patient to Test?\n",
    "\n",
    "**Run Cell 3.5 first** - it will show you which patient has:\n",
    "- ‚úì Conditions (diseases)\n",
    "- ‚úì Allergies  \n",
    "- ‚úì Prescriptions (drugs)\n",
    "\n",
    "**Best patient to test:** The one with the MOST records in all 3 categories = you'll see real outputs in all cells!"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "88251c66",
   "metadata": {},
   "source": [
    "## CELL 1 ‚Äì Imports\n",
    "\n",
    "**What this does:** Loads the Python libraries needed for the entire pipeline.\n",
    "- `pandas` = Work with CSV data tables\n",
    "- `transformers` = Hugging Face library for AI models\n",
    "- `json` = Format alerts as JSON\n",
    "\n",
    "**Expected output:** None (just imports libraries silently)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "4d5caf2e",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "from transformers import pipeline\n",
    "import json"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "de34ed53",
   "metadata": {},
   "source": [
    "## CELL 2 ‚Äì Load Hugging Face Model\n",
    "\n",
    "**What this does:** Downloads and loads the biomedical NER (Named Entity Recognition) AI model.\n",
    "- Model: `d4data/biomedical-ner-all`\n",
    "- Purpose: Extracts medical terms (drugs, diseases) from natural language text\n",
    "- This is the ONLY AI component - everything else is rule-based\n",
    "\n",
    "**Expected output:** \"Model loaded successfully\" (may take 1-2 minutes first time - downloads model)\n",
    "\n",
    "**Technical note:** Uses `aggregation_strategy=\"simple\"` to merge multi-word entities (e.g., \"Type 2 Diabetes\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "4d60752b",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\jashu\\anaconda3\\Lib\\site-packages\\huggingface_hub\\file_download.py:942: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.\n",
      "  warnings.warn(\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Model loaded successfully\n"
     ]
    }
   ],
   "source": [
    "# Load the biomedical NER model from Hugging Face\n",
    "ner_pipeline = pipeline(\n",
    "    \"ner\",\n",
    "    model=\"d4data/biomedical-ner-all\",\n",
    "    aggregation_strategy=\"simple\"\n",
    ")\n",
    "\n",
    "print(\"Model loaded successfully\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "daa7736a",
   "metadata": {},
   "source": [
    "## CELL 3 ‚Äì Load CSV Files\n",
    "\n",
    "**What this does:** Loads all 7 CSV files from your workspace into memory.\n",
    "\n",
    "**Patient Data Files:**\n",
    "1. `patients.csv` - Patient identity and demographics\n",
    "2. `allergies.csv` - Known allergies (linked by ABHA ID)\n",
    "3. `conditions.csv` - Medical conditions/diseases (linked by ABHA ID)\n",
    "4. `prescriptions.csv` - Current medications (linked by ABHA ID)\n",
    "5. `lab_reports.csv` - Lab test results (linked by ABHA ID)\n",
    "\n",
    "**Medical Knowledge Files (not linked to any patient):**\n",
    "6. `drug_interactions.csv` - Drug-Drug interaction rules\n",
    "7. `disease_contra.csv` - Disease-Drug contraindication rules\n",
    "\n",
    "**Expected output:** \"All datasets loaded successfully\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "8154f84c",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "All datasets loaded successfully\n"
     ]
    }
   ],
   "source": [
    "# Load all 7 CSV files from the current directory\n",
    "patients_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\patients.csv')\n",
    "allergies_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\allergies.csv')\n",
    "conditions_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\conditions.csv')\n",
    "prescriptions_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\prescriptions.csv')\n",
    "lab_reports_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\lab_reports.csv')\n",
    "drug_interactions_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\drug_interactions.csv')\n",
    "disease_contra_df = pd.read_csv('C:\\\\Users\\\\jashu\\\\Downloads\\\\Fortex36\\\\disease_contra.csv')\n",
    "\n",
    "print(\"All datasets loaded successfully\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "0761fc65",
   "metadata": {},
   "source": [
    "## CELL 3.5 ‚Äì Explore Available Patients & Select One\n",
    "\n",
    "**‚≠ê RUN THIS CELL FIRST TO FIND THE BEST PATIENT TO TEST!**\n",
    "\n",
    "**What this does:**\n",
    "1. Lists ALL patients in your database with their demographics\n",
    "2. Shows summary statistics (total records across all files)\n",
    "3. **Shows data availability** for each patient:\n",
    "   - How many allergies they have\n",
    "   - How many conditions they have\n",
    "   - How many prescriptions they have\n",
    "\n",
    "**Expected output:** \n",
    "- Table of all patients\n",
    "- Summary showing which patient has the MOST complete data\n",
    "\n",
    "**üëâ ACTION:** Look for a patient with numbers in ALL 3 columns (Allergies > 0, Conditions > 0, Prescriptions > 0)\n",
    "   - This patient will produce outputs in ALL subsequent cells\n",
    "   - If a patient has 0 prescriptions, Cell 8 (drug interactions) will show \"No alerts\""
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "id": "0961d126",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "====================================================================================================\n",
      "AVAILABLE PATIENTS IN DATABASE\n",
      "====================================================================================================\n",
      "abha_id patient_id         name  age gender blood_group\n",
      "ABHA001 HOSP1_P001   Ravi Kumar   42   Male          O+\n",
      "ABHA002 HOSP1_P002 Anita Sharma   29 Female          B+\n",
      "ABHA003 HOSP2_P011  Arjun Mehta   55   Male          A-\n",
      "ABHA004 HOSP2_P012   Neha Verma   35 Female          O-\n",
      "ABHA005 HOSP3_P101  Karan Singh   60   Male          B-\n",
      "ABHA006 HOSP3_P102  Priya Patel   24 Female          A+\n",
      "ABHA007 HOSP4_P201    Manoj Das   48   Male         AB+\n",
      "ABHA008 HOSP4_P202    Sneha Roy   31 Female          O+\n",
      "ABHA009 HOSP5_P301  Vikram Iyer   67   Male          A+\n",
      "ABHA010 HOSP5_P302   Pooja Nair   40 Female          B+\n",
      "ABHA011 HOSP6_P401 Rajesh Gupta   58   Male         AB-\n",
      "====================================================================================================\n",
      "\n",
      "Total Patients: 11\n",
      "Total Allergies Records: 12\n",
      "Total Conditions Records: 16\n",
      "Total Prescriptions: 19\n",
      "Total Lab Reports: 10\n",
      "\n",
      "====================================================================================================\n",
      "PATIENT DATA SUMMARY\n",
      "====================================================================================================\n",
      "ABHA ID      Name                 Allergies    Conditions   Prescriptions\n",
      "----------------------------------------------------------------------------------------------------\n",
      "ABHA001      Ravi Kumar           2            2            3            ‚≠ê BEST\n",
      "ABHA002      Anita Sharma         1            1            1           \n",
      "ABHA003      Arjun Mehta          1            1            2           \n",
      "ABHA004      Neha Verma           0            1            1           \n",
      "ABHA005      Karan Singh          1            2            2           \n",
      "ABHA006      Priya Patel          0            1            1           \n",
      "ABHA007      Manoj Das            2            1            1           \n",
      "ABHA008      Sneha Roy            0            1            1           \n",
      "ABHA009      Vikram Iyer          1            1            1           \n",
      "ABHA010      Pooja Nair           1            1            1           \n",
      "ABHA011      Rajesh Gupta         3            4            5            ‚≠ê BEST\n",
      "====================================================================================================\n",
      "\n",
      "üéØ RECOMMENDED PATIENT TO TEST: ABHA011\n",
      "   This patient has complete data in ALL categories (allergies, conditions, prescriptions)\n",
      "   You will see outputs in ALL cells (6-12) when testing this patient!\n",
      "\n",
      "üëâ CHOOSE A PATIENT BY ENTERING THEIR ABHA_ID IN THE NEXT CELL\n",
      "   Example: abha_id = 'ABHA001'  or  abha_id = 'ABHA002'\n",
      "\n"
     ]
    }
   ],
   "source": [
    "# Display all available patients with their basic info\n",
    "print(\"=\" * 100)\n",
    "print(\"AVAILABLE PATIENTS IN DATABASE\")\n",
    "print(\"=\" * 100)\n",
    "print(patients_df[['abha_id', 'patient_id', 'name', 'age', 'gender', 'blood_group']].to_string(index=False))\n",
    "print(\"=\" * 100)\n",
    "\n",
    "# Show summary statistics\n",
    "print(f\"\\nTotal Patients: {len(patients_df)}\")\n",
    "print(f\"Total Allergies Records: {len(allergies_df)}\")\n",
    "print(f\"Total Conditions Records: {len(conditions_df)}\")\n",
    "print(f\"Total Prescriptions: {len(prescriptions_df)}\")\n",
    "print(f\"Total Lab Reports: {len(lab_reports_df)}\")\n",
    "\n",
    "# Show what data exists for each patient\n",
    "print(\"\\n\" + \"=\" * 100)\n",
    "print(\"PATIENT DATA SUMMARY\")\n",
    "print(\"=\" * 100)\n",
    "print(f\"{'ABHA ID':<12} {'Name':<20} {'Allergies':<12} {'Conditions':<12} {'Prescriptions':<12}\")\n",
    "print(\"-\" * 100)\n",
    "\n",
    "best_patient = None\n",
    "max_total = 0\n",
    "\n",
    "for _, patient in patients_df.iterrows():\n",
    "    abha = patient['abha_id']\n",
    "    name = patient['name']\n",
    "    \n",
    "    allergy_count = len(allergies_df[allergies_df['abha_id'] == abha])\n",
    "    condition_count = len(conditions_df[conditions_df['abha_id'] == abha])\n",
    "    prescription_count = len(prescriptions_df[prescriptions_df['abha_id'] == abha])\n",
    "    \n",
    "    total = allergy_count + condition_count + prescription_count\n",
    "    \n",
    "    # Track patient with most complete data\n",
    "    if allergy_count > 0 and condition_count > 0 and prescription_count > 0 and total > max_total:\n",
    "        best_patient = abha\n",
    "        max_total = total\n",
    "    \n",
    "    marker = \" ‚≠ê BEST\" if abha == best_patient else \"\"\n",
    "    print(f\"{abha:<12} {name:<20} {allergy_count:<12} {condition_count:<12} {prescription_count:<12}{marker}\")\n",
    "\n",
    "print(\"=\" * 100)\n",
    "\n",
    "if best_patient:\n",
    "    print(f\"\\nüéØ RECOMMENDED PATIENT TO TEST: {best_patient}\")\n",
    "    print(f\"   This patient has complete data in ALL categories (allergies, conditions, prescriptions)\")\n",
    "    print(f\"   You will see outputs in ALL cells (6-12) when testing this patient!\\n\")\n",
    "else:\n",
    "    print(f\"\\n‚ö†Ô∏è  No patient has complete data in all 3 categories.\")\n",
    "    print(f\"   Pick a patient with the most records to see maximum outputs.\\n\")\n",
    "\n",
    "print(\"üëâ CHOOSE A PATIENT BY ENTERING THEIR ABHA_ID IN THE NEXT CELL\")\n",
    "print(\"   Example: abha_id = 'ABHA001'  or  abha_id = 'ABHA002'\\n\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "9fc76306",
   "metadata": {},
   "source": [
    "## CELL 3.6 ‚Äì Interactive Testing Mode (Type Your Own Values)\n",
    "\n",
    "**What this does:** Lets YOU manually test the system with real or custom data.\n",
    "\n",
    "**Two testing modes:**\n",
    "\n",
    "**Mode 1 - Test Real Patient:**\n",
    "- Type an ABHA ID from your CSV\n",
    "- System loads that patient's actual data\n",
    "- Proves the system works with real database records\n",
    "\n",
    "**Mode 2 - Test Custom Data (Manual Entry):**\n",
    "- Type your own conditions (e.g., \"Diabetes, Heart Failure\")\n",
    "- Type your own allergies (e.g., \"Penicillin\")\n",
    "- Type your own medications (e.g., \"Warfarin, Aspirin, Metformin\")\n",
    "- Proves the AI and rules engine work with ANY input\n",
    "\n",
    "**Expected output:** \n",
    "- Prompts asking you to choose mode and enter data\n",
    "- Confirmation showing what data will be tested\n",
    "\n",
    "**When to use:**\n",
    "- Use Mode 1 to test real patients from your CSV\n",
    "- Use Mode 2 to test edge cases or verify specific drug interactions work"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "id": "c57ff54e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üß™ INTERACTIVE TESTING MODE\n",
      "================================================================================\n",
      "\n",
      "Available ABHA IDs: ['ABHA001', 'ABHA002', 'ABHA003', 'ABHA004', 'ABHA005', 'ABHA006', 'ABHA007', 'ABHA008', 'ABHA009', 'ABHA010', 'ABHA011']\n",
      "\n",
      "‚úì Patient found: Rajesh Gupta\n",
      "  - Conditions: ['Heart Disease', 'Hypertension', 'Diabetes', 'Asthma']\n",
      "  - Allergies: ['Penicillin', 'Shellfish', 'Sulfa Drugs']\n",
      "  - Current Drugs: ['Warfarin', 'Aspirin', 'Ibuprofen', 'Clopidogrel', 'Metformin']\n",
      "\n",
      "================================================================================\n",
      "‚úì Test data ready. Continue to next cells to see AI analysis.\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# ============================================================================\n",
    "# MANUAL TESTING MODE - Type your own values to test the system\n",
    "# ============================================================================\n",
    "\n",
    "print(\"üß™ INTERACTIVE TESTING MODE\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "# Option 1: Test with a patient from CSV\n",
    "test_mode = input(\"\\nChoose test mode:\\n1 = Use existing patient from CSV\\n2 = Enter custom drugs/conditions manually\\nEnter (1 or 2): \").strip()\n",
    "\n",
    "if test_mode == \"1\":\n",
    "    # Test with existing patient\n",
    "    print(f\"\\nAvailable ABHA IDs: {patients_df['abha_id'].tolist()}\")\n",
    "    abha_id = input(\"\\nüëâ Type an ABHA ID to test (e.g., ABHA001): \").strip()\n",
    "    \n",
    "    if abha_id in patients_df['abha_id'].values:\n",
    "        patient_info = patients_df[patients_df['abha_id'] == abha_id]\n",
    "        patient_allergies = allergies_df[allergies_df['abha_id'] == abha_id]\n",
    "        patient_conditions = conditions_df[conditions_df['abha_id'] == abha_id]\n",
    "        patient_prescriptions = prescriptions_df[prescriptions_df['abha_id'] == abha_id]\n",
    "        \n",
    "        print(f\"\\n‚úì Patient found: {patient_info.iloc[0]['name']}\")\n",
    "        print(f\"  - Conditions: {patient_conditions['condition'].tolist()}\")\n",
    "        print(f\"  - Allergies: {patient_allergies['substance'].tolist()}\")\n",
    "        print(f\"  - Current Drugs: {patient_prescriptions['drug'].tolist()}\")\n",
    "        \n",
    "        # Use this patient for testing\n",
    "        test_conditions = patient_conditions['condition'].tolist()\n",
    "        test_allergies = patient_allergies['substance'].tolist()\n",
    "        test_drugs = patient_prescriptions['drug'].tolist()\n",
    "    else:\n",
    "        print(f\"‚ùå Patient {abha_id} not found!\")\n",
    "        test_conditions = []\n",
    "        test_allergies = []\n",
    "        test_drugs = []\n",
    "\n",
    "elif test_mode == \"2\":\n",
    "    # Manual custom testing\n",
    "    print(\"\\nüìù Enter custom data to test the AI engine:\")\n",
    "    \n",
    "    # Get custom conditions\n",
    "    conditions_input = input(\"\\nEnter patient conditions (comma-separated, e.g., Diabetes, Hypertension): \").strip()\n",
    "    test_conditions = [c.strip() for c in conditions_input.split(',') if c.strip()]\n",
    "    \n",
    "    # Get custom allergies\n",
    "    allergies_input = input(\"Enter patient allergies (comma-separated, e.g., Penicillin, Aspirin): \").strip()\n",
    "    test_allergies = [a.strip() for a in allergies_input.split(',') if a.strip()]\n",
    "    \n",
    "    # Get custom drugs\n",
    "    drugs_input = input(\"Enter current medications (comma-separated, e.g., Warfarin, Aspirin, Metformin): \").strip()\n",
    "    test_drugs = [d.strip() for d in drugs_input.split(',') if d.strip()]\n",
    "    \n",
    "    print(\"\\n‚úì Custom test data recorded:\")\n",
    "    print(f\"  - Conditions: {test_conditions}\")\n",
    "    print(f\"  - Allergies: {test_allergies}\")\n",
    "    print(f\"  - Drugs: {test_drugs}\")\n",
    "\n",
    "else:\n",
    "    print(\"‚ùå Invalid option. Please run this cell again.\")\n",
    "    test_conditions = []\n",
    "    test_allergies = []\n",
    "    test_drugs = []\n",
    "\n",
    "# Store for use in subsequent cells\n",
    "manual_test_mode = test_mode\n",
    "manual_test_conditions = test_conditions\n",
    "manual_test_allergies = test_allergies\n",
    "manual_test_drugs = test_drugs\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"‚úì Test data ready. Continue to next cells to see AI analysis.\")\n",
    "print(\"=\" * 80)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "23f716ee",
   "metadata": {},
   "source": [
    "## CELL 4 ‚Äì Select Patient by ABHA ID (Default Mode)\n",
    "\n",
    "**What this does:** Standard patient selection (alternative to Cell 3.6)\n",
    "- Change `abha_id = \"ABHA001\"` to any ABHA ID you saw in Cell 3.5\n",
    "- Filters and displays all data for that patient\n",
    "- Shows identity, allergies, conditions, and prescriptions\n",
    "\n",
    "**Expected output:**\n",
    "- Patient demographics table\n",
    "- Allergies table (or \"No allergies recorded\")\n",
    "- Conditions table (or \"No conditions recorded\")\n",
    "- Prescriptions table (or \"No prescriptions recorded\")\n",
    "\n",
    "**Use this OR Cell 3.6 - not both!**\n",
    "- Cell 3.6 = Interactive typing\n",
    "- Cell 4 = Quick patient switching"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "id": "c0fed13e",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úì Selected Patient: ABHA011\n",
      "\n",
      "================================================================================\n",
      "PATIENT IDENTITY (ABHA ID: ABHA011)\n",
      "================================================================================\n",
      "abha_id patient_id         name  age gender blood_group hospital_name      phone\n",
      "ABHA011 HOSP6_P401 Rajesh Gupta   58   Male         AB-  Max Hospital 9998887776\n",
      "\n",
      "================================================================================\n",
      "PATIENT ALLERGIES (3 record(s))\n",
      "================================================================================\n",
      "allergy_id abha_id allergy_type   substance severity first_detected\n",
      "      A010 ABHA011         Drug  Penicillin   Severe     2015-06-10\n",
      "      A011 ABHA011         Food   Shellfish Moderate     2018-09-22\n",
      "      A012 ABHA011         Drug Sulfa Drugs   Severe     2020-03-14\n",
      "\n",
      "================================================================================\n",
      "PATIENT CONDITIONS (4 record(s))\n",
      "================================================================================\n",
      "condition_id abha_id     condition chronic  since  status\n",
      "        C013 ABHA011 Heart Disease     Yes   2016 Ongoing\n",
      "        C014 ABHA011  Hypertension     Yes   2017 Ongoing\n",
      "        C015 ABHA011      Diabetes     Yes   2019 Ongoing\n",
      "        C016 ABHA011        Asthma     Yes   2020 Ongoing\n",
      "\n",
      "================================================================================\n",
      "PATIENT PRESCRIPTIONS (5 record(s))\n",
      "================================================================================\n",
      "prescription_id abha_id        drug  dose frequency start_date   end_date status\n",
      "          PR013 ABHA011    Warfarin   5mg     1/day 2016-11-01        NaN Active\n",
      "          PR014 ABHA011     Aspirin 100mg     1/day 2017-02-15        NaN Active\n",
      "          PR015 ABHA011   Ibuprofen 400mg     3/day 2025-12-20 2026-01-20 Active\n",
      "          PR016 ABHA011 Clopidogrel  75mg     1/day 2018-06-01        NaN Active\n",
      "          PR017 ABHA011   Metformin 850mg     2/day 2019-08-01        NaN Active\n"
     ]
    }
   ],
   "source": [
    "# ========================================\n",
    "# üëá CHANGE THIS VALUE TO TEST DIFFERENT PATIENTS\n",
    "# ========================================\n",
    "abha_id = \"ABHA011\"  # ‚Üê Edit this to select a different patient (e.g., \"ABHA002\", \"ABHA003\", etc.)\n",
    "# ========================================\n",
    "\n",
    "# Verify patient exists\n",
    "if abha_id not in patients_df['abha_id'].values:\n",
    "    print(f\"‚ùå ERROR: Patient {abha_id} not found in database!\")\n",
    "    print(f\"Available patients: {patients_df['abha_id'].tolist()}\")\n",
    "else:\n",
    "    print(f\"‚úì Selected Patient: {abha_id}\")\n",
    "    \n",
    "    # Filter patient data\n",
    "    patient_info = patients_df[patients_df['abha_id'] == abha_id]\n",
    "    patient_allergies = allergies_df[allergies_df['abha_id'] == abha_id]\n",
    "    patient_conditions = conditions_df[conditions_df['abha_id'] == abha_id]\n",
    "    patient_prescriptions = prescriptions_df[prescriptions_df['abha_id'] == abha_id]\n",
    "    \n",
    "    print(\"\\n\" + \"=\" * 80)\n",
    "    print(f\"PATIENT IDENTITY (ABHA ID: {abha_id})\")\n",
    "    print(\"=\" * 80)\n",
    "    print(patient_info.to_string(index=False))\n",
    "    \n",
    "    print(\"\\n\" + \"=\" * 80)\n",
    "    print(f\"PATIENT ALLERGIES ({len(patient_allergies)} record(s))\")\n",
    "    print(\"=\" * 80)\n",
    "    if patient_allergies.empty:\n",
    "        print(\"No allergies recorded\")\n",
    "    else:\n",
    "        print(patient_allergies.to_string(index=False))\n",
    "    \n",
    "    print(\"\\n\" + \"=\" * 80)\n",
    "    print(f\"PATIENT CONDITIONS ({len(patient_conditions)} record(s))\")\n",
    "    print(\"=\" * 80)\n",
    "    if patient_conditions.empty:\n",
    "        print(\"No conditions recorded\")\n",
    "    else:\n",
    "        print(patient_conditions.to_string(index=False))\n",
    "    \n",
    "    print(\"\\n\" + \"=\" * 80)\n",
    "    print(f\"PATIENT PRESCRIPTIONS ({len(patient_prescriptions)} record(s))\")\n",
    "    print(\"=\" * 80)\n",
    "    if patient_prescriptions.empty:\n",
    "        print(\"No prescriptions recorded\")\n",
    "    else:\n",
    "        print(patient_prescriptions.to_string(index=False))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "78a573b4",
   "metadata": {},
   "source": [
    "## CELL 5 ‚Äì Build Medical Text\n",
    "\n",
    "**What this does:** Converts structured CSV data into natural language text for the AI model.\n",
    "\n",
    "**Process:**\n",
    "1. Extracts conditions, allergies, and drugs from selected patient (or manual input)\n",
    "2. Builds a sentence: \"Patient has [conditions]. Patient is allergic to [allergies]. Currently taking [drugs].\"\n",
    "3. This text is fed to the AI model in the next cell\n",
    "\n",
    "**Expected output:**\n",
    "- The medical text sentence\n",
    "- Summary showing how many items in each category\n",
    "\n",
    "**Example output:**\n",
    "```\n",
    "Patient has Diabetes, Hypertension. Patient is allergic to Penicillin. Currently taking Metformin, Lisinopril, Aspirin.\n",
    "\n",
    "Input Summary:\n",
    "  ‚Ä¢ Conditions: 2\n",
    "  ‚Ä¢ Allergies: 1\n",
    "  ‚Ä¢ Drugs: 3\n",
    "```\n",
    "\n",
    "**Why this matters:** The AI model needs natural language, not CSV rows!"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "7bf6eeb0",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "üß™ Using MANUAL TEST DATA\n",
      "\n",
      "================================================================================\n",
      "MEDICAL TEXT FOR NER PROCESSING\n",
      "================================================================================\n",
      "Patient has Heart Disease, Hypertension, Diabetes, Asthma. Patient is allergic to Penicillin, Shellfish, Sulfa Drugs. Currently taking Warfarin, Aspirin, Ibuprofen, Clopidogrel, Metformin.\n",
      "\n",
      "================================================================================\n",
      "Input Summary:\n",
      "  ‚Ä¢ Conditions: 4\n",
      "  ‚Ä¢ Allergies: 3\n",
      "  ‚Ä¢ Drugs: 5\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# Extract lists from filtered data OR use manual test data\n",
    "if 'manual_test_mode' in globals() and manual_test_mode in ['1', '2']:\n",
    "    # Use manually entered or selected test data\n",
    "    conditions_list = manual_test_conditions\n",
    "    allergies_list = manual_test_allergies\n",
    "    drugs_list = manual_test_drugs\n",
    "    print(\"üß™ Using MANUAL TEST DATA\")\n",
    "else:\n",
    "    # Use data from Cell 4 (default mode)\n",
    "    conditions_list = patient_conditions['condition'].tolist() if not patient_conditions.empty else []\n",
    "    allergies_list = patient_allergies['substance'].tolist() if not patient_allergies.empty else []\n",
    "    drugs_list = patient_prescriptions['drug'].tolist() if not patient_prescriptions.empty else []\n",
    "    print(\"üìä Using data from selected patient\")\n",
    "\n",
    "# Generate medical text\n",
    "conditions_text = \", \".join(conditions_list) if conditions_list else \"no known conditions\"\n",
    "allergies_text = \", \".join(allergies_list) if allergies_list else \"no known allergies\"\n",
    "drugs_text = \", \".join(drugs_list) if drugs_list else \"no current medications\"\n",
    "\n",
    "medical_text = f\"Patient has {conditions_text}. Patient is allergic to {allergies_text}. Currently taking {drugs_text}.\"\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"MEDICAL TEXT FOR NER PROCESSING\")\n",
    "print(\"=\" * 80)\n",
    "print(medical_text)\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(f\"Input Summary:\")\n",
    "print(f\"  ‚Ä¢ Conditions: {len(conditions_list)}\")\n",
    "print(f\"  ‚Ä¢ Allergies: {len(allergies_list)}\")\n",
    "print(f\"  ‚Ä¢ Drugs: {len(drugs_list)}\")\n",
    "print(\"=\" * 80)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "648a2fdc",
   "metadata": {},
   "source": [
    "## CELL 6 ‚Äì Run Hugging Face NER\n",
    "\n",
    "**What this does:** THE AI STEP - Sends the medical text to the Hugging Face model for entity recognition.\n",
    "\n",
    "**AI Process:**\n",
    "1. Model reads the natural language text\n",
    "2. Identifies and extracts medical entities\n",
    "3. Labels each entity with a type (Chemical, Disease, etc.)\n",
    "4. Returns all found entities with confidence scores\n",
    "\n",
    "**Expected output:** List of dictionaries showing:\n",
    "- `entity_group` - Type of entity (Chemical, Disease, etc.)\n",
    "- `score` - AI confidence (0.0 to 1.0)\n",
    "- `word` - The extracted term\n",
    "- `start/end` - Position in text\n",
    "\n",
    "**Example output:**\n",
    "```\n",
    "{'entity_group': 'Disease', 'score': 0.99, 'word': 'Diabetes', 'start': 12, 'end': 20}\n",
    "{'entity_group': 'Chemical', 'score': 0.98, 'word': 'Metformin', 'start': 65, 'end': 74}\n",
    "```\n",
    "\n",
    "**Will have output if:** Patient has ANY conditions, allergies, or drugs in their record"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "a0e77398",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "HUGGING FACE NER OUTPUT (Raw Entities)\n",
      "================================================================================\n",
      "{'entity_group': 'History', 'score': 0.98423994, 'word': 'heart', 'start': 12, 'end': 17}\n",
      "{'entity_group': 'History', 'score': 0.94199425, 'word': 'hypertension', 'start': 27, 'end': 39}\n",
      "{'entity_group': 'History', 'score': 0.9594798, 'word': 'diabetes', 'start': 41, 'end': 49}\n",
      "{'entity_group': 'History', 'score': 0.83555067, 'word': 'asthma', 'start': 51, 'end': 57}\n",
      "{'entity_group': 'History', 'score': 0.79525733, 'word': 'allergic', 'start': 70, 'end': 78}\n",
      "{'entity_group': 'History', 'score': 0.91147965, 'word': 'penicillin', 'start': 82, 'end': 92}\n",
      "{'entity_group': 'History', 'score': 0.94382787, 'word': 'shellfish', 'start': 94, 'end': 103}\n",
      "{'entity_group': 'History', 'score': 0.6690097, 'word': 'sulfa drugs', 'start': 105, 'end': 116}\n",
      "{'entity_group': 'Medication', 'score': 0.99966204, 'word': 'war', 'start': 135, 'end': 138}\n",
      "{'entity_group': 'Medication', 'score': 0.9260918, 'word': '##far', 'start': 138, 'end': 141}\n",
      "{'entity_group': 'Medication', 'score': 0.99894065, 'word': 'as', 'start': 145, 'end': 147}\n",
      "{'entity_group': 'Medication', 'score': 0.98220485, 'word': '##pi', 'start': 147, 'end': 149}\n",
      "{'entity_group': 'Medication', 'score': 0.99937564, 'word': 'ib', 'start': 154, 'end': 156}\n",
      "{'entity_group': 'Medication', 'score': 0.9035145, 'word': '##up', 'start': 156, 'end': 158}\n",
      "{'entity_group': 'Medication', 'score': 0.9854515, 'word': 'cl', 'start': 165, 'end': 167}\n",
      "{'entity_group': 'Medication', 'score': 0.9986657, 'word': '##op', 'start': 167, 'end': 169}\n",
      "{'entity_group': 'Medication', 'score': 0.9878511, 'word': '##ido', 'start': 169, 'end': 172}\n",
      "{'entity_group': 'Medication', 'score': 0.99963975, 'word': 'met', 'start': 178, 'end': 181}\n"
     ]
    }
   ],
   "source": [
    "# Run NER model on the medical text\n",
    "ner_results = ner_pipeline(medical_text)\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"HUGGING FACE NER OUTPUT (Raw Entities)\")\n",
    "print(\"=\" * 80)\n",
    "for entity in ner_results:\n",
    "    print(entity)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "df58b9d1",
   "metadata": {},
   "source": [
    "## CELL 7 ‚Äì Extract Medical Entities\n",
    "\n",
    "**What this does:** Filters and cleans the AI output to get only drugs and diseases.\n",
    "\n",
    "**Process:**\n",
    "1. Loops through all entities from Cell 6\n",
    "2. If `entity_group == \"Chemical\"` ‚Üí Add to drugs list\n",
    "3. If `entity_group == \"Disease\"` ‚Üí Add to diseases list\n",
    "4. Removes duplicates\n",
    "\n",
    "**Expected output:**\n",
    "```\n",
    "Extracted Drugs: ['Metformin', 'Lisinopril', 'Aspirin']\n",
    "Extracted Diseases: ['Diabetes', 'Hypertension']\n",
    "```\n",
    "\n",
    "**Will have output if:** Patient has conditions or prescriptions\n",
    "\n",
    "**NOTE:** These extracted lists are used in Cells 8-9 for safety checks!"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "e54b4087",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "NER MODEL OUTPUT ANALYSIS\n",
      "================================================================================\n",
      "Total entities found by AI: 18\n",
      "\n",
      "Entity: 'heart' | Type: History | Confidence: 0.98\n",
      "Entity: 'hypertension' | Type: History | Confidence: 0.94\n",
      "Entity: 'diabetes' | Type: History | Confidence: 0.96\n",
      "Entity: 'asthma' | Type: History | Confidence: 0.84\n",
      "Entity: 'allergic' | Type: History | Confidence: 0.80\n",
      "Entity: 'penicillin' | Type: History | Confidence: 0.91\n",
      "Entity: 'shellfish' | Type: History | Confidence: 0.94\n",
      "Entity: 'sulfa drugs' | Type: History | Confidence: 0.67\n",
      "Entity: 'war' | Type: Medication | Confidence: 1.00\n",
      "Entity: '##far' | Type: Medication | Confidence: 0.93\n",
      "Entity: 'as' | Type: Medication | Confidence: 1.00\n",
      "Entity: '##pi' | Type: Medication | Confidence: 0.98\n",
      "Entity: 'ib' | Type: Medication | Confidence: 1.00\n",
      "Entity: '##up' | Type: Medication | Confidence: 0.90\n",
      "Entity: 'cl' | Type: Medication | Confidence: 0.99\n",
      "Entity: '##op' | Type: Medication | Confidence: 1.00\n",
      "Entity: '##ido' | Type: Medication | Confidence: 0.99\n",
      "Entity: 'met' | Type: Medication | Confidence: 1.00\n",
      "\n",
      "================================================================================\n",
      "AI EXTRACTION RESULTS\n",
      "================================================================================\n",
      "Extracted Drugs: []\n",
      "Extracted Diseases: []\n",
      "\n",
      "‚ö†Ô∏è  NER did not extract drugs. Using original CSV data as fallback.\n",
      "‚ö†Ô∏è  NER did not extract diseases. Using original CSV data as fallback.\n",
      "\n",
      "================================================================================\n",
      "FINAL EXTRACTED MEDICAL ENTITIES (for safety checks)\n",
      "================================================================================\n",
      "‚úì Drugs to check: ['Warfarin', 'Aspirin', 'Ibuprofen', 'Clopidogrel', 'Metformin']\n",
      "‚úì Diseases to check: ['Heart Disease', 'Hypertension', 'Diabetes', 'Asthma']\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# Extract drugs and diseases from NER results\n",
    "extracted_drugs = []\n",
    "extracted_diseases = []\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"NER MODEL OUTPUT ANALYSIS\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if ner_results:\n",
    "    print(f\"Total entities found by AI: {len(ner_results)}\\n\")\n",
    "    \n",
    "    for entity in ner_results:\n",
    "        entity_group = entity.get('entity_group', '')\n",
    "        word = entity.get('word', '').strip()\n",
    "        score = entity.get('score', 0)\n",
    "        \n",
    "        print(f\"Entity: '{word}' | Type: {entity_group} | Confidence: {score:.2f}\")\n",
    "        \n",
    "        if entity_group == \"Chemical\" and word:\n",
    "            extracted_drugs.append(word)\n",
    "        elif entity_group == \"Disease\" and word:\n",
    "            extracted_diseases.append(word)\n",
    "else:\n",
    "    print(\"‚ö†Ô∏è  No entities detected by NER model\")\n",
    "\n",
    "# Remove duplicates while preserving order\n",
    "extracted_drugs = list(dict.fromkeys(extracted_drugs))\n",
    "extracted_diseases = list(dict.fromkeys(extracted_diseases))\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"AI EXTRACTION RESULTS\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"Extracted Drugs: {extracted_drugs}\")\n",
    "print(f\"Extracted Diseases: {extracted_diseases}\")\n",
    "\n",
    "# FALLBACK: If NER fails to extract, use original CSV data directly\n",
    "if len(extracted_drugs) == 0 and len(drugs_list) > 0:\n",
    "    print(\"\\n‚ö†Ô∏è  NER did not extract drugs. Using original CSV data as fallback.\")\n",
    "    extracted_drugs = drugs_list.copy()\n",
    "\n",
    "if len(extracted_diseases) == 0 and len(conditions_list) > 0:\n",
    "    print(\"‚ö†Ô∏è  NER did not extract diseases. Using original CSV data as fallback.\")\n",
    "    extracted_diseases = conditions_list.copy()\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"FINAL EXTRACTED MEDICAL ENTITIES (for safety checks)\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"‚úì Drugs to check: {extracted_drugs}\")\n",
    "print(f\"‚úì Diseases to check: {extracted_diseases}\")\n",
    "print(\"=\" * 80)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5543424f",
   "metadata": {},
   "source": [
    "## CELL 8 ‚Äì Drug‚ÄìDrug Interaction Check\n",
    "\n",
    "**What this does:** RULE-BASED SAFETY CHECK - Compares every pair of extracted drugs against the knowledge base.\n",
    "\n",
    "**Process:**\n",
    "1. Takes all extracted drugs from Cell 7\n",
    "2. Checks every possible pair (e.g., Drug1 + Drug2)\n",
    "3. Searches `drug_interactions.csv` for matches (checks both orders: A+B and B+A)\n",
    "4. If found, creates an alert with risk description and severity\n",
    "\n",
    "**Expected output:** List of drug-drug interaction alerts (or empty if no interactions)\n",
    "\n",
    "**Example output:**\n",
    "```\n",
    "{'type': 'Drug-Drug', 'drugs': ['Warfarin', 'Aspirin'], \n",
    " 'risk': 'Increased bleeding risk', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
    "```\n",
    "\n",
    "**Will have output ONLY if:**\n",
    "- Patient has 2+ prescriptions (drugs) in Cell 7\n",
    "- AND those drugs have a recorded interaction in `drug_interactions.csv`\n",
    "\n",
    "**Will show \"No alerts\" if:** Patient has 0-1 drugs, or drugs don't interact"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "c35b99bd",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "DRUG-DRUG INTERACTION CHECK\n",
      "================================================================================\n",
      "Checking 5 drugs for interactions...\n",
      "\n",
      "Checking: Warfarin + Aspirin... ‚ö†Ô∏è  INTERACTION FOUND! Severity: HIGH\n",
      "Checking: Warfarin + Ibuprofen... ‚ö†Ô∏è  INTERACTION FOUND! Severity: HIGH\n",
      "Checking: Warfarin + Clopidogrel... ‚ö†Ô∏è  INTERACTION FOUND! Severity: HIGH\n",
      "Checking: Warfarin + Metformin... ‚úì No interaction\n",
      "Checking: Aspirin + Ibuprofen... ‚ö†Ô∏è  INTERACTION FOUND! Severity: LOW\n",
      "Checking: Aspirin + Clopidogrel... ‚ö†Ô∏è  INTERACTION FOUND! Severity: HIGH\n",
      "‚ö†Ô∏è  INTERACTION FOUND! Severity: HIGH\n",
      "Checking: Aspirin + Metformin... ‚úì No interaction\n",
      "Checking: Ibuprofen + Clopidogrel... ‚úì No interaction\n",
      "Checking: Ibuprofen + Metformin... ‚úì No interaction\n",
      "Checking: Clopidogrel + Metformin... ‚úì No interaction\n",
      "\n",
      "Total drug pairs checked: 10\n",
      "Total interactions found: 6\n",
      "\n",
      "================================================================================\n",
      "DRUG-DRUG INTERACTION ALERTS\n",
      "================================================================================\n",
      "\n",
      "1. {'type': 'Drug-Drug', 'drugs': ['Warfarin', 'Aspirin'], 'risk': 'Severely increases bleeding risk', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
      "\n",
      "2. {'type': 'Drug-Drug', 'drugs': ['Warfarin', 'Ibuprofen'], 'risk': 'High risk of gastrointestinal bleeding', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
      "\n",
      "3. {'type': 'Drug-Drug', 'drugs': ['Warfarin', 'Clopidogrel'], 'risk': 'Extreme bleeding risk - life threatening', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
      "\n",
      "4. {'type': 'Drug-Drug', 'drugs': ['Aspirin', 'Ibuprofen'], 'risk': 'Reduces cardioprotective effect of aspirin', 'severity': 'LOW', 'source': 'drug_interactions.csv'}\n",
      "\n",
      "5. {'type': 'Drug-Drug', 'drugs': ['Aspirin', 'Clopidogrel'], 'risk': 'Excessive bleeding risk', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
      "\n",
      "6. {'type': 'Drug-Drug', 'drugs': ['Aspirin', 'Clopidogrel'], 'risk': 'Excessive bleeding risk', 'severity': 'HIGH', 'source': 'drug_interactions.csv'}\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# Check for drug-drug interactions\n",
    "drug_drug_alerts = []\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"DRUG-DRUG INTERACTION CHECK\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"Checking {len(extracted_drugs)} drugs for interactions...\\n\")\n",
    "\n",
    "if len(extracted_drugs) < 2:\n",
    "    print(\"‚ö†Ô∏è  Need at least 2 drugs to check interactions.\")\n",
    "    print(f\"   Current drugs: {extracted_drugs}\")\n",
    "else:\n",
    "    # Compare every pair of extracted drugs\n",
    "    pairs_checked = 0\n",
    "    for i in range(len(extracted_drugs)):\n",
    "        for j in range(i + 1, len(extracted_drugs)):\n",
    "            drug1 = extracted_drugs[i]\n",
    "            drug2 = extracted_drugs[j]\n",
    "            pairs_checked += 1\n",
    "            \n",
    "            print(f\"Checking: {drug1} + {drug2}...\", end=\" \")\n",
    "            \n",
    "            # Check both orders in drug_interactions.csv\n",
    "            interaction = drug_interactions_df[\n",
    "                ((drug_interactions_df['drug1'].str.lower() == drug1.lower()) & \n",
    "                 (drug_interactions_df['drug2'].str.lower() == drug2.lower())) |\n",
    "                ((drug_interactions_df['drug1'].str.lower() == drug2.lower()) & \n",
    "                 (drug_interactions_df['drug2'].str.lower() == drug1.lower()))\n",
    "            ]\n",
    "            \n",
    "            if not interaction.empty:\n",
    "                for _, row in interaction.iterrows():\n",
    "                    alert = {\n",
    "                        \"type\": \"Drug-Drug\",\n",
    "                        \"drugs\": [drug1, drug2],\n",
    "                        \"risk\": row['risk'],\n",
    "                        \"severity\": row['severity'],\n",
    "                        \"source\": \"drug_interactions.csv\"\n",
    "                    }\n",
    "                    drug_drug_alerts.append(alert)\n",
    "                    print(f\"‚ö†Ô∏è  INTERACTION FOUND! Severity: {row['severity']}\")\n",
    "            else:\n",
    "                print(\"‚úì No interaction\")\n",
    "    \n",
    "    print(f\"\\nTotal drug pairs checked: {pairs_checked}\")\n",
    "    print(f\"Total interactions found: {len(drug_drug_alerts)}\")\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"DRUG-DRUG INTERACTION ALERTS\")\n",
    "print(\"=\" * 80)\n",
    "if drug_drug_alerts:\n",
    "    for idx, alert in enumerate(drug_drug_alerts, 1):\n",
    "        print(f\"\\n{idx}. {alert}\")\n",
    "else:\n",
    "    print(\"‚úì No drug-drug interactions detected\")\n",
    "print(\"=\" * 80)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4a14639c",
   "metadata": {},
   "source": [
    "## CELL 9 ‚Äì Disease‚ÄìDrug Contraindication Check\n",
    "\n",
    "**What this does:** RULE-BASED SAFETY CHECK - Checks if any disease makes any drug unsafe.\n",
    "\n",
    "**Process:**\n",
    "1. Takes diseases from Cell 7 and drugs from Cell 7\n",
    "2. Checks every disease √ó drug combination\n",
    "3. Searches `disease_contra.csv` for matches\n",
    "4. If found, creates an alert with warning and severity\n",
    "\n",
    "**Expected output:** List of disease-drug contraindication alerts (or empty if no contraindications)\n",
    "\n",
    "**Example output:**\n",
    "```\n",
    "{'type': 'Disease-Drug', 'condition': 'Heart Failure', 'drug': 'Metformin',\n",
    " 'warning': 'May worsen kidney function', 'severity': 'MEDIUM', 'source': 'disease_contra.csv'}\n",
    "```\n",
    "\n",
    "**Will have output ONLY if:**\n",
    "- Patient has conditions (diseases) AND prescriptions (drugs)\n",
    "- AND that combination is listed in `disease_contra.csv`\n",
    "\n",
    "**Will show \"No alerts\" if:** No contraindications exist for this patient's disease-drug combinations"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "id": "fc139e68",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "DISEASE-DRUG CONTRAINDICATION CHECK\n",
      "================================================================================\n",
      "Checking 4 disease(s) √ó 5 drug(s) combinations...\n",
      "\n",
      "Checking: Heart Disease + Warfarin... ‚úì No contraindication\n",
      "Checking: Heart Disease + Aspirin... ‚úì No contraindication\n",
      "Checking: Heart Disease + Ibuprofen... ‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: HIGH\n",
      "Checking: Heart Disease + Clopidogrel... ‚úì No contraindication\n",
      "Checking: Heart Disease + Metformin... ‚úì No contraindication\n",
      "Checking: Hypertension + Warfarin... ‚úì No contraindication\n",
      "Checking: Hypertension + Aspirin... ‚úì No contraindication\n",
      "Checking: Hypertension + Ibuprofen... ‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: MEDIUM\n",
      "Checking: Hypertension + Clopidogrel... ‚úì No contraindication\n",
      "Checking: Hypertension + Metformin... ‚úì No contraindication\n",
      "Checking: Diabetes + Warfarin... ‚úì No contraindication\n",
      "Checking: Diabetes + Aspirin... ‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: MEDIUM\n",
      "Checking: Diabetes + Ibuprofen... ‚úì No contraindication\n",
      "Checking: Diabetes + Clopidogrel... ‚úì No contraindication\n",
      "Checking: Diabetes + Metformin... ‚úì No contraindication\n",
      "Checking: Asthma + Warfarin... ‚úì No contraindication\n",
      "Checking: Asthma + Aspirin... ‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: HIGH\n",
      "‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: HIGH\n",
      "Checking: Asthma + Ibuprofen... ‚úì No contraindication\n",
      "Checking: Asthma + Clopidogrel... ‚úì No contraindication\n",
      "Checking: Asthma + Metformin... ‚úì No contraindication\n",
      "\n",
      "Total combinations checked: 20\n",
      "Total contraindications found: 5\n",
      "\n",
      "================================================================================\n",
      "DISEASE-DRUG CONTRAINDICATION ALERTS\n",
      "================================================================================\n",
      "\n",
      "1. {'type': 'Disease-Drug', 'condition': 'Heart Disease', 'drug': 'Ibuprofen', 'warning': 'Significantly increases risk of heart attack and stroke', 'severity': 'HIGH', 'source': 'disease_contra.csv'}\n",
      "\n",
      "2. {'type': 'Disease-Drug', 'condition': 'Hypertension', 'drug': 'Ibuprofen', 'warning': 'Increases blood pressure', 'severity': 'MEDIUM', 'source': 'disease_contra.csv'}\n",
      "\n",
      "3. {'type': 'Disease-Drug', 'condition': 'Diabetes', 'drug': 'Aspirin', 'warning': 'May affect blood sugar regulation in diabetic patients', 'severity': 'MEDIUM', 'source': 'disease_contra.csv'}\n",
      "\n",
      "4. {'type': 'Disease-Drug', 'condition': 'Asthma', 'drug': 'Aspirin', 'warning': 'Can trigger severe asthma attacks', 'severity': 'HIGH', 'source': 'disease_contra.csv'}\n",
      "\n",
      "5. {'type': 'Disease-Drug', 'condition': 'Asthma', 'drug': 'Aspirin', 'warning': 'Can trigger severe asthma attacks and bronchospasm', 'severity': 'HIGH', 'source': 'disease_contra.csv'}\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# Check for disease-drug contraindications\n",
    "disease_drug_alerts = []\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"DISEASE-DRUG CONTRAINDICATION CHECK\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"Checking {len(extracted_diseases)} disease(s) √ó {len(extracted_drugs)} drug(s) combinations...\\n\")\n",
    "\n",
    "if len(extracted_diseases) == 0:\n",
    "    print(\"‚ö†Ô∏è  No diseases to check\")\n",
    "elif len(extracted_drugs) == 0:\n",
    "    print(\"‚ö†Ô∏è  No drugs to check\")\n",
    "else:\n",
    "    # Compare each disease with each drug\n",
    "    combinations_checked = 0\n",
    "    for disease in extracted_diseases:\n",
    "        for drug in extracted_drugs:\n",
    "            combinations_checked += 1\n",
    "            print(f\"Checking: {disease} + {drug}...\", end=\" \")\n",
    "            \n",
    "            contraindication = disease_contra_df[\n",
    "                (disease_contra_df['condition'].str.lower() == disease.lower()) & \n",
    "                (disease_contra_df['drug'].str.lower() == drug.lower())\n",
    "            ]\n",
    "            \n",
    "            if not contraindication.empty:\n",
    "                for _, row in contraindication.iterrows():\n",
    "                    alert = {\n",
    "                        \"type\": \"Disease-Drug\",\n",
    "                        \"condition\": disease,\n",
    "                        \"drug\": drug,\n",
    "                        \"warning\": row['warning'],\n",
    "                        \"severity\": row['severity'],\n",
    "                        \"source\": \"disease_contra.csv\"\n",
    "                    }\n",
    "                    disease_drug_alerts.append(alert)\n",
    "                    print(f\"‚ö†Ô∏è  CONTRAINDICATION FOUND! Severity: {row['severity']}\")\n",
    "            else:\n",
    "                print(\"‚úì No contraindication\")\n",
    "    \n",
    "    print(f\"\\nTotal combinations checked: {combinations_checked}\")\n",
    "    print(f\"Total contraindications found: {len(disease_drug_alerts)}\")\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"DISEASE-DRUG CONTRAINDICATION ALERTS\")\n",
    "print(\"=\" * 80)\n",
    "if disease_drug_alerts:\n",
    "    for idx, alert in enumerate(disease_drug_alerts, 1):\n",
    "        print(f\"\\n{idx}. {alert}\")\n",
    "else:\n",
    "    print(\"‚úì No disease-drug contraindications detected\")\n",
    "print(\"=\" * 80)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "3fd2babb",
   "metadata": {},
   "source": [
    "## CELL 10 ‚Äì Combine Alerts\n",
    "\n",
    "**What this does:** Merges all alerts from Cells 8 and 9 into a single list and formats as JSON.\n",
    "\n",
    "**Process:**\n",
    "1. Combines drug-drug alerts + disease-drug alerts\n",
    "2. Pretty-prints the combined list in JSON format\n",
    "\n",
    "**Expected output:** JSON-formatted list of all safety alerts\n",
    "\n",
    "**Example output:**\n",
    "```json\n",
    "[\n",
    "  {\n",
    "    \"type\": \"Drug-Drug\",\n",
    "    \"drugs\": [\"Warfarin\", \"Aspirin\"],\n",
    "    \"risk\": \"Increased bleeding risk\",\n",
    "    \"severity\": \"HIGH\",\n",
    "    \"source\": \"drug_interactions.csv\"\n",
    "  },\n",
    "  {\n",
    "    \"type\": \"Disease-Drug\",\n",
    "    \"condition\": \"Diabetes\",\n",
    "    \"drug\": \"Aspirin\",\n",
    "    \"warning\": \"May affect blood sugar levels\",\n",
    "    \"severity\": \"LOW\",\n",
    "    \"source\": \"disease_contra.csv\"\n",
    "  }\n",
    "]\n",
    "```\n",
    "\n",
    "**Will have output if:** Either Cell 8 OR Cell 9 found alerts"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "id": "dd6f83ec",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "COMBINED ALERTS (JSON Format)\n",
      "================================================================================\n",
      "[\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Warfarin\",\n",
      "      \"Aspirin\"\n",
      "    ],\n",
      "    \"risk\": \"Severely increases bleeding risk\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Warfarin\",\n",
      "      \"Ibuprofen\"\n",
      "    ],\n",
      "    \"risk\": \"High risk of gastrointestinal bleeding\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Warfarin\",\n",
      "      \"Clopidogrel\"\n",
      "    ],\n",
      "    \"risk\": \"Extreme bleeding risk - life threatening\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Aspirin\",\n",
      "      \"Ibuprofen\"\n",
      "    ],\n",
      "    \"risk\": \"Reduces cardioprotective effect of aspirin\",\n",
      "    \"severity\": \"LOW\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Aspirin\",\n",
      "      \"Clopidogrel\"\n",
      "    ],\n",
      "    \"risk\": \"Excessive bleeding risk\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Drug-Drug\",\n",
      "    \"drugs\": [\n",
      "      \"Aspirin\",\n",
      "      \"Clopidogrel\"\n",
      "    ],\n",
      "    \"risk\": \"Excessive bleeding risk\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"drug_interactions.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Disease-Drug\",\n",
      "    \"condition\": \"Heart Disease\",\n",
      "    \"drug\": \"Ibuprofen\",\n",
      "    \"warning\": \"Significantly increases risk of heart attack and stroke\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"disease_contra.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Disease-Drug\",\n",
      "    \"condition\": \"Hypertension\",\n",
      "    \"drug\": \"Ibuprofen\",\n",
      "    \"warning\": \"Increases blood pressure\",\n",
      "    \"severity\": \"MEDIUM\",\n",
      "    \"source\": \"disease_contra.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Disease-Drug\",\n",
      "    \"condition\": \"Diabetes\",\n",
      "    \"drug\": \"Aspirin\",\n",
      "    \"warning\": \"May affect blood sugar regulation in diabetic patients\",\n",
      "    \"severity\": \"MEDIUM\",\n",
      "    \"source\": \"disease_contra.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Disease-Drug\",\n",
      "    \"condition\": \"Asthma\",\n",
      "    \"drug\": \"Aspirin\",\n",
      "    \"warning\": \"Can trigger severe asthma attacks\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"disease_contra.csv\"\n",
      "  },\n",
      "  {\n",
      "    \"type\": \"Disease-Drug\",\n",
      "    \"condition\": \"Asthma\",\n",
      "    \"drug\": \"Aspirin\",\n",
      "    \"warning\": \"Can trigger severe asthma attacks and bronchospasm\",\n",
      "    \"severity\": \"HIGH\",\n",
      "    \"source\": \"disease_contra.csv\"\n",
      "  }\n",
      "]\n"
     ]
    }
   ],
   "source": [
    "# Combine all alerts into a single list\n",
    "all_alerts = drug_drug_alerts + disease_drug_alerts\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"COMBINED ALERTS (JSON Format)\")\n",
    "print(\"=\" * 80)\n",
    "print(json.dumps(all_alerts, indent=2))"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "c1806a0f",
   "metadata": {},
   "source": [
    "## CELL 11 ‚Äì Compute Final Risk Level\n",
    "\n",
    "**What this does:** Calculates the overall patient risk based on the highest severity alert.\n",
    "\n",
    "**Severity Scoring:**\n",
    "- LOW = 1 point\n",
    "- MEDIUM = 2 points\n",
    "- HIGH = 3 points\n",
    "\n",
    "**Logic:**\n",
    "- If NO alerts ‚Üí **SAFE**\n",
    "- If alerts exist ‚Üí Take the HIGHEST severity level\n",
    "\n",
    "**Expected output:**\n",
    "```\n",
    "Overall Patient Risk Level: HIGH\n",
    "```\n",
    "(or SAFE / LOW / MEDIUM / HIGH depending on alerts)\n",
    "\n",
    "**Will always have output** - either \"SAFE\" or the highest severity from alerts\n",
    "\n",
    "**Examples:**\n",
    "- 0 alerts ‚Üí **SAFE**\n",
    "- Only LOW alerts ‚Üí **LOW**\n",
    "- Mix of LOW + MEDIUM ‚Üí **MEDIUM**\n",
    "- Any HIGH alert ‚Üí **HIGH** (even if there are also LOW/MEDIUM alerts)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "id": "c99c6b71",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "RISK ASSESSMENT\n",
      "================================================================================\n",
      "Overall Patient Risk Level: HIGH\n"
     ]
    }
   ],
   "source": [
    "# Severity mapping\n",
    "severity_map = {\n",
    "    \"LOW\": 1,\n",
    "    \"MEDIUM\": 2,\n",
    "    \"HIGH\": 3\n",
    "}\n",
    "\n",
    "# Compute overall risk level\n",
    "if not all_alerts:\n",
    "    overall_risk = \"SAFE\"\n",
    "else:\n",
    "    max_severity_score = max(severity_map.get(alert['severity'], 0) for alert in all_alerts)\n",
    "    \n",
    "    # Convert score back to severity label\n",
    "    for severity_label, score in severity_map.items():\n",
    "        if score == max_severity_score:\n",
    "            overall_risk = severity_label\n",
    "            break\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"RISK ASSESSMENT\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"Overall Patient Risk Level: {overall_risk}\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "660694bb",
   "metadata": {},
   "source": [
    "## CELL 12 ‚Äì Explainability Layer\n",
    "\n",
    "**What this does:** THE MOST IMPORTANT CELL - Provides human-readable explanations for every alert.\n",
    "\n",
    "**Process:**\n",
    "1. For each alert, prints:\n",
    "   - Alert number\n",
    "   - Rule type (Drug-Drug or Disease-Drug)\n",
    "   - Source CSV file (proves it's rule-based, not AI guess)\n",
    "   - Condition involved (if disease-drug alert)\n",
    "   - Drugs involved\n",
    "   - Medical reason (WHY it's dangerous)\n",
    "   - Severity level\n",
    "\n",
    "2. Provides final summary\n",
    "\n",
    "**Expected output:** Detailed explanation for each alert\n",
    "\n",
    "**Example output:**\n",
    "```\n",
    "================================================================================\n",
    "ALERT #1\n",
    "================================================================================\n",
    "\n",
    "Why this alert?\n",
    "\n",
    "Rule type: Drug-Drug\n",
    "Source CSV: drug_interactions.csv\n",
    "Condition (if any): N/A\n",
    "Drugs involved: Warfarin, Aspirin\n",
    "Medical reason: Increased bleeding risk - both are blood thinners\n",
    "Severity: HIGH\n",
    "\n",
    "================================================================================\n",
    "SUMMARY: 2 alert(s) detected with overall risk level: HIGH\n",
    "================================================================================\n",
    "```\n",
    "\n",
    "**Will have output if:** Any alerts were found in Cells 8-9\n",
    "\n",
    "**This proves:** All decisions are explainable and traceable to CSV rules (NOT a black-box AI)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "id": "401808b0",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "================================================================================\n",
      "EXPLAINABILITY LAYER - DETAILED ALERT EXPLANATIONS\n",
      "================================================================================\n",
      "\n",
      "================================================================================\n",
      "ALERT #1\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Warfarin, Aspirin\n",
      "Medical reason: Severely increases bleeding risk\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #2\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Warfarin, Ibuprofen\n",
      "Medical reason: High risk of gastrointestinal bleeding\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #3\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Warfarin, Clopidogrel\n",
      "Medical reason: Extreme bleeding risk - life threatening\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #4\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Aspirin, Ibuprofen\n",
      "Medical reason: Reduces cardioprotective effect of aspirin\n",
      "Severity: LOW\n",
      "\n",
      "================================================================================\n",
      "ALERT #5\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Aspirin, Clopidogrel\n",
      "Medical reason: Excessive bleeding risk\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #6\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Drug-Drug\n",
      "Source CSV: drug_interactions.csv\n",
      "Condition (if any): N/A\n",
      "Drugs involved: Aspirin, Clopidogrel\n",
      "Medical reason: Excessive bleeding risk\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #7\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Disease-Drug\n",
      "Source CSV: disease_contra.csv\n",
      "Condition (if any): Heart Disease\n",
      "Drugs involved: Ibuprofen\n",
      "Medical reason: Significantly increases risk of heart attack and stroke\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #8\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Disease-Drug\n",
      "Source CSV: disease_contra.csv\n",
      "Condition (if any): Hypertension\n",
      "Drugs involved: Ibuprofen\n",
      "Medical reason: Increases blood pressure\n",
      "Severity: MEDIUM\n",
      "\n",
      "================================================================================\n",
      "ALERT #9\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Disease-Drug\n",
      "Source CSV: disease_contra.csv\n",
      "Condition (if any): Diabetes\n",
      "Drugs involved: Aspirin\n",
      "Medical reason: May affect blood sugar regulation in diabetic patients\n",
      "Severity: MEDIUM\n",
      "\n",
      "================================================================================\n",
      "ALERT #10\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Disease-Drug\n",
      "Source CSV: disease_contra.csv\n",
      "Condition (if any): Asthma\n",
      "Drugs involved: Aspirin\n",
      "Medical reason: Can trigger severe asthma attacks\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "ALERT #11\n",
      "================================================================================\n",
      "\n",
      "Why this alert?\n",
      "\n",
      "Rule type: Disease-Drug\n",
      "Source CSV: disease_contra.csv\n",
      "Condition (if any): Asthma\n",
      "Drugs involved: Aspirin\n",
      "Medical reason: Can trigger severe asthma attacks and bronchospasm\n",
      "Severity: HIGH\n",
      "\n",
      "================================================================================\n",
      "SUMMARY: 11 alert(s) detected with overall risk level: HIGH\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "# Generate detailed explanations for each alert\n",
    "print(\"=\" * 80)\n",
    "print(\"EXPLAINABILITY LAYER - DETAILED ALERT EXPLANATIONS\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if not all_alerts:\n",
    "    print(\"\\n‚úì No safety alerts detected. Patient risk is SAFE.\")\n",
    "else:\n",
    "    for idx, alert in enumerate(all_alerts, 1):\n",
    "        print(f\"\\n{'=' * 80}\")\n",
    "        print(f\"ALERT #{idx}\")\n",
    "        print(f\"{'=' * 80}\")\n",
    "        print(f\"\\nWhy this alert?\\n\")\n",
    "        print(f\"Rule type: {alert['type']}\")\n",
    "        print(f\"Source CSV: {alert['source']}\")\n",
    "        \n",
    "        if alert['type'] == \"Drug-Drug\":\n",
    "            print(f\"Condition (if any): N/A\")\n",
    "            print(f\"Drugs involved: {', '.join(alert['drugs'])}\")\n",
    "            print(f\"Medical reason: {alert['risk']}\")\n",
    "        else:  # Disease-Drug\n",
    "            print(f\"Condition (if any): {alert['condition']}\")\n",
    "            print(f\"Drugs involved: {alert['drug']}\")\n",
    "            print(f\"Medical reason: {alert['warning']}\")\n",
    "        \n",
    "        print(f\"Severity: {alert['severity']}\")\n",
    "\n",
    "print(f\"\\n{'=' * 80}\")\n",
    "print(f\"SUMMARY: {len(all_alerts)} alert(s) detected with overall risk level: {overall_risk}\")\n",
    "print(f\"{'=' * 80}\")"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a467de84",
   "metadata": {},
   "source": [
    "## CELL 13 ‚Äì Clinical Recommendations & Contraindications Summary\n",
    "\n",
    "**What this does:** Provides clear, actionable clinical conclusions based on all findings.\n",
    "\n",
    "**Process:**\n",
    "1. Lists all dangerous drug combinations that MUST NOT be used together\n",
    "2. Shows disease-drug contraindications (drugs that should be avoided given patient's conditions)\n",
    "3. Summarizes patient's known allergies\n",
    "4. Provides final clinical recommendation\n",
    "\n",
    "**Expected output:** Clinical summary with specific warnings and recommendations\n",
    "\n",
    "**This is the FINAL OUTPUT** - What a doctor/pharmacist would see to make treatment decisions"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "id": "776fa788",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà                    CLINICAL DECISION SUMMARY                                 ‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "\n",
      "================================================================================\n",
      "PATIENT INFORMATION\n",
      "================================================================================\n",
      "ABHA ID: ABHA011\n",
      "Hospital Patient ID: HOSP6_P401\n",
      "Name: Rajesh Gupta\n",
      "Age: 58 years | Gender: Male\n",
      "Blood Group: AB-\n",
      "Hospital: Max Hospital\n",
      "Contact: 9998887776\n",
      "Report Generated: 2026-01-29 10:07:15\n",
      "================================================================================\n",
      "\n",
      "üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥\n",
      "‚ö†Ô∏è  CRITICAL: KNOWN ALLERGIES - DO NOT PRESCRIBE\n",
      "üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥üî¥\n",
      "Total Allergies on Record: 3\n",
      "\n",
      "1. ‚ùå PENICILLIN\n",
      "   Severity: Severe\n",
      "   First Detected: 2015-06-10\n",
      "   Status: ACTIVE - DO NOT PRESCRIBE\n",
      "\n",
      "2. ‚ùå SHELLFISH\n",
      "   Severity: Moderate\n",
      "   First Detected: 2018-09-22\n",
      "   Status: ACTIVE - DO NOT PRESCRIBE\n",
      "\n",
      "3. ‚ùå SULFA DRUGS\n",
      "   Severity: Severe\n",
      "   First Detected: 2020-03-14\n",
      "   Status: ACTIVE - DO NOT PRESCRIBE\n",
      "\n",
      "\n",
      "\n",
      "================================================================================\n",
      "‚ö†Ô∏è  DANGEROUS DRUG COMBINATIONS DETECTED\n",
      "================================================================================\n",
      "\n",
      "üö® HIGH RISK COMBINATIONS (5) - IMMEDIATE ACTION REQUIRED:\n",
      "--------------------------------------------------------------------------------\n",
      "\n",
      "1. ‚ùå DO NOT USE TOGETHER: Warfarin + Aspirin\n",
      "   Reason: Severely increases bleeding risk\n",
      "   Action: Consult physician to adjust medication immediately\n",
      "\n",
      "2. ‚ùå DO NOT USE TOGETHER: Warfarin + Ibuprofen\n",
      "   Reason: High risk of gastrointestinal bleeding\n",
      "   Action: Consult physician to adjust medication immediately\n",
      "\n",
      "3. ‚ùå DO NOT USE TOGETHER: Warfarin + Clopidogrel\n",
      "   Reason: Extreme bleeding risk - life threatening\n",
      "   Action: Consult physician to adjust medication immediately\n",
      "\n",
      "4. ‚ùå DO NOT USE TOGETHER: Aspirin + Clopidogrel\n",
      "   Reason: Excessive bleeding risk\n",
      "   Action: Consult physician to adjust medication immediately\n",
      "\n",
      "5. ‚ùå DO NOT USE TOGETHER: Aspirin + Clopidogrel\n",
      "   Reason: Excessive bleeding risk\n",
      "   Action: Consult physician to adjust medication immediately\n",
      "\n",
      "‚ÑπÔ∏è  LOW RISK COMBINATIONS (1) - AWARENESS NEEDED:\n",
      "--------------------------------------------------------------------------------\n",
      "1. Aspirin + Ibuprofen - Reduces cardioprotective effect of aspirin\n",
      "\n",
      "================================================================================\n",
      "‚ö†Ô∏è  DISEASE-DRUG CONTRAINDICATIONS\n",
      "================================================================================\n",
      "These drugs should be AVOIDED or closely monitored given patient's conditions:\n",
      "\n",
      "üö® HIGH RISK (3) - STRONGLY CONTRAINDICATED:\n",
      "--------------------------------------------------------------------------------\n",
      "\n",
      "1. ‚ùå IBUPROFEN - Contraindicated for Heart Disease\n",
      "   Warning: Significantly increases risk of heart attack and stroke\n",
      "   Action: Consider alternative medication\n",
      "\n",
      "2. ‚ùå ASPIRIN - Contraindicated for Asthma\n",
      "   Warning: Can trigger severe asthma attacks\n",
      "   Action: Consider alternative medication\n",
      "\n",
      "3. ‚ùå ASPIRIN - Contraindicated for Asthma\n",
      "   Warning: Can trigger severe asthma attacks and bronchospasm\n",
      "   Action: Consider alternative medication\n",
      "\n",
      "‚ö†Ô∏è  MEDIUM RISK (2) - USE WITH CAUTION:\n",
      "--------------------------------------------------------------------------------\n",
      "\n",
      "1. ‚ö†Ô∏è  Ibuprofen - Risk for Hypertension patients\n",
      "   Warning: Increases blood pressure\n",
      "   Action: Monitor patient closely, adjust dosage if needed\n",
      "\n",
      "2. ‚ö†Ô∏è  Aspirin - Risk for Diabetes patients\n",
      "   Warning: May affect blood sugar regulation in diabetic patients\n",
      "   Action: Monitor patient closely, adjust dosage if needed\n",
      "\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà                       FINAL RECOMMENDATION                                   ‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "\n",
      "Overall Risk Level: HIGH\n",
      "Total Safety Alerts: 11\n",
      "  - Drug-Drug Interactions: 6\n",
      "  - Disease-Drug Contraindications: 5\n",
      "\n",
      "================================================================================\n",
      "CLINICAL ACTION REQUIRED:\n",
      "================================================================================\n",
      "üö® URGENT: HIGH RISK DETECTED\n",
      "   ‚û§ Immediate physician consultation required\n",
      "   ‚û§ Do NOT proceed with current medication regimen without review\n",
      "   ‚û§ Consider alternative drugs or dosage adjustments\n",
      "   ‚û§ Monitor patient for adverse effects\n",
      "\n",
      "================================================================================\n",
      "MEDICATIONS SUMMARY (DETAILED):\n",
      "================================================================================\n",
      "Total Active Medications: 5\n",
      "\n",
      "  1. Warfarin ‚ö†Ô∏è (INTERACTION RISK)\n",
      "     Dosage: 5mg\n",
      "     Frequency: 1/day\n",
      "     Prescribed: 2016-11-01\n",
      "     Status: Active\n",
      "     Safety Assessment: CAUTION\n",
      "     ‚ö†Ô∏è  Interactions with: Aspirin (HIGH), Ibuprofen (HIGH), Clopidogrel (HIGH)\n",
      "\n",
      "  2. Aspirin ‚ö†Ô∏è‚ö†Ô∏è (MULTIPLE RISKS)\n",
      "     Dosage: 100mg\n",
      "     Frequency: 1/day\n",
      "     Prescribed: 2017-02-15\n",
      "     Status: Active\n",
      "     Safety Assessment: HIGH RISK\n",
      "     ‚ö†Ô∏è  Interactions with: Warfarin (HIGH), Ibuprofen (LOW), Clopidogrel (HIGH), Clopidogrel (HIGH)\n",
      "     ‚ö†Ô∏è  Contraindicated for: Diabetes (MEDIUM), Asthma (HIGH), Asthma (HIGH)\n",
      "\n",
      "  3. Ibuprofen ‚ö†Ô∏è‚ö†Ô∏è (MULTIPLE RISKS)\n",
      "     Dosage: 400mg\n",
      "     Frequency: 3/day\n",
      "     Prescribed: 2025-12-20\n",
      "     Status: Active\n",
      "     Safety Assessment: HIGH RISK\n",
      "     ‚ö†Ô∏è  Interactions with: Warfarin (HIGH), Aspirin (LOW)\n",
      "     ‚ö†Ô∏è  Contraindicated for: Heart Disease (HIGH), Hypertension (MEDIUM)\n",
      "\n",
      "  4. Clopidogrel ‚ö†Ô∏è (INTERACTION RISK)\n",
      "     Dosage: 75mg\n",
      "     Frequency: 1/day\n",
      "     Prescribed: 2018-06-01\n",
      "     Status: Active\n",
      "     Safety Assessment: CAUTION\n",
      "     ‚ö†Ô∏è  Interactions with: Warfarin (HIGH), Aspirin (HIGH), Aspirin (HIGH)\n",
      "\n",
      "  5. Metformin ‚úì\n",
      "     Dosage: 850mg\n",
      "     Frequency: 2/day\n",
      "     Prescribed: 2019-08-01\n",
      "     Status: Active\n",
      "     Safety Assessment: SAFE\n",
      "\n",
      "\n",
      "================================================================================\n",
      "CONDITIONS SUMMARY (DETAILED):\n",
      "================================================================================\n",
      "Total Active Conditions: 4\n",
      "\n",
      "  1. Heart Disease\n",
      "     Status: Ongoing\n",
      "     Since: 2016\n",
      "     Chronic: Yes\n",
      "     ‚ö†Ô∏è  Affects medications: Ibuprofen (HIGH risk)\n",
      "\n",
      "  2. Hypertension\n",
      "     Status: Ongoing\n",
      "     Since: 2017\n",
      "     Chronic: Yes\n",
      "     ‚ö†Ô∏è  Affects medications: Ibuprofen (MEDIUM risk)\n",
      "\n",
      "  3. Diabetes\n",
      "     Status: Ongoing\n",
      "     Since: 2019\n",
      "     Chronic: Yes\n",
      "     ‚ö†Ô∏è  Affects medications: Aspirin (MEDIUM risk)\n",
      "\n",
      "  4. Asthma\n",
      "     Status: Ongoing\n",
      "     Since: 2020\n",
      "     Chronic: Yes\n",
      "     ‚ö†Ô∏è  Affects medications: Aspirin (HIGH risk), Aspirin (HIGH risk)\n",
      "\n",
      "\n",
      "================================================================================\n",
      "LABORATORY REPORTS:\n",
      "================================================================================\n",
      "  No recent lab reports on file\n",
      "  Recommendation: Order baseline labs for medication monitoring\n",
      "\n",
      "================================================================================\n",
      "RISK MITIGATION STRATEGIES:\n",
      "================================================================================\n",
      "\n",
      "RECOMMENDED ACTIONS TO REDUCE RISK:\n",
      "\n",
      "‚Ä¢ Discontinue or replace one of: Warfarin + Aspirin\n",
      "  Alternative: Consult pharmacist for substitute medication\n",
      "‚Ä¢ Discontinue or replace one of: Warfarin + Ibuprofen\n",
      "  Alternative: Consult pharmacist for substitute medication\n",
      "‚Ä¢ Discontinue or replace one of: Warfarin + Clopidogrel\n",
      "  Alternative: Consult pharmacist for substitute medication\n",
      "‚Ä¢ Discontinue or replace one of: Aspirin + Clopidogrel\n",
      "  Alternative: Consult pharmacist for substitute medication\n",
      "‚Ä¢ Discontinue or replace one of: Aspirin + Clopidogrel\n",
      "  Alternative: Consult pharmacist for substitute medication\n",
      "‚Ä¢ Replace Ibuprofen due to Heart Disease\n",
      "  Reason: Significantly increases risk of heart attack and stroke\n",
      "‚Ä¢ Replace Aspirin due to Asthma\n",
      "  Reason: Can trigger severe asthma attacks\n",
      "‚Ä¢ Replace Aspirin due to Asthma\n",
      "  Reason: Can trigger severe asthma attacks and bronchospasm\n",
      "‚Ä¢ Consider staggered dosing schedules to minimize interactions\n",
      "‚Ä¢ Monitor vital signs more frequently (daily if HIGH risk)\n",
      "‚Ä¢ Schedule follow-up labs to monitor organ function\n",
      "‚Ä¢ Patient education on warning signs and symptoms\n",
      "\n",
      "================================================================================\n",
      "FOLLOW-UP RECOMMENDATIONS:\n",
      "================================================================================\n",
      "\n",
      "üö® URGENT FOLLOW-UP REQUIRED:\n",
      "  ‚Ä¢ Schedule physician consultation within 24-48 hours\n",
      "  ‚Ä¢ Do NOT wait for next scheduled appointment\n",
      "  ‚Ä¢ Consider emergency department if symptoms worsen\n",
      "  ‚Ä¢ Daily medication review until risk is mitigated\n",
      "\n",
      "================================================================================\n",
      "PATIENT EDUCATION POINTS:\n",
      "================================================================================\n",
      "\n",
      "What the patient should know:\n",
      "\n",
      "1. You are currently taking 5 medication(s)\n",
      "2. You have 4 condition(s) being managed\n",
      "3. You have 3 known allergy/allergies on file\n",
      "4. Your current risk level is: HIGH\n",
      "\n",
      "5. Important Safety Information:\n",
      "   ‚Ä¢ There are 11 potential safety concern(s)\n",
      "   ‚Ä¢ Do NOT start any new medications without consulting your doctor\n",
      "   ‚Ä¢ Do NOT stop current medications without medical advice\n",
      "   ‚Ä¢ Report these symptoms immediately:\n",
      "     - Unusual bleeding or bruising\n",
      "\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà                              END OF REPORT                                    ‚ñà\n",
      "‚ñà                                                                              ‚ñà\n",
      "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà\n",
      "\n",
      "================================================================================\n",
      "REPORT METADATA\n",
      "================================================================================\n",
      "‚úì LifeLine AI Clinical Decision Support Analysis Complete\n",
      "  Report Generated: 2026-01-29 10:07:15\n",
      "  AI Model: d4data/biomedical-ner-all (Hugging Face)\n",
      "  Rule Engine: drug_interactions.csv + disease_contra.csv\n",
      "  Total Entities Extracted: 5 drugs, 4 diseases\n",
      "  Total Safety Rules Checked: 105\n",
      "  Analysis Method: AI-assisted entity extraction + Rule-based safety validation\n",
      "================================================================================\n"
     ]
    }
   ],
   "source": [
    "print(\"\\n\" + \"‚ñà\" * 80)\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 20 + \"CLINICAL DECISION SUMMARY\" + \" \" * 33 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" * 80 + \"\\n\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 1: PATIENT INFORMATION (Enhanced)\n",
    "# ============================================================================\n",
    "print(\"=\" * 80)\n",
    "print(\"PATIENT INFORMATION\")\n",
    "print(\"=\" * 80)\n",
    "if 'patient_info' in globals() and not patient_info.empty:\n",
    "    print(f\"ABHA ID: {patient_info.iloc[0]['abha_id']}\")\n",
    "    print(f\"Hospital Patient ID: {patient_info.iloc[0]['patient_id']}\")\n",
    "    print(f\"Name: {patient_info.iloc[0]['name']}\")\n",
    "    print(f\"Age: {patient_info.iloc[0]['age']} years | Gender: {patient_info.iloc[0]['gender']}\")\n",
    "    print(f\"Blood Group: {patient_info.iloc[0]['blood_group']}\")\n",
    "    print(f\"Hospital: {patient_info.iloc[0]['hospital_name']}\")\n",
    "    print(f\"Contact: {patient_info.iloc[0]['phone']}\")\n",
    "else:\n",
    "    print(\"Patient: Custom Test Data\")\n",
    "print(f\"Report Generated: {pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')}\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 2: KNOWN ALLERGIES (Enhanced with severity and dates)\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"üî¥\" * 40)\n",
    "print(\"‚ö†Ô∏è  CRITICAL: KNOWN ALLERGIES - DO NOT PRESCRIBE\")\n",
    "print(\"üî¥\" * 40)\n",
    "if len(allergies_list) > 0:\n",
    "    print(f\"Total Allergies on Record: {len(allergies_list)}\\n\")\n",
    "    for idx, allergy in enumerate(allergies_list, 1):\n",
    "        print(f\"{idx}. ‚ùå {allergy.upper()}\")\n",
    "        \n",
    "        # Get detailed allergy information if available\n",
    "        if 'patient_allergies' in globals() and not patient_allergies.empty:\n",
    "            allergy_details = patient_allergies[patient_allergies['substance'].str.lower() == allergy.lower()]\n",
    "            if not allergy_details.empty:\n",
    "                for _, a_row in allergy_details.iterrows():\n",
    "                    print(f\"   Severity: {a_row['severity']}\")\n",
    "                    print(f\"   First Detected: {a_row['first_detected']}\")\n",
    "                    print(f\"   Status: ACTIVE - DO NOT PRESCRIBE\")\n",
    "        print()\n",
    "else:\n",
    "    print(\"‚úì No known allergies recorded\")\n",
    "print(\"\\n\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 3: DANGEROUS DRUG COMBINATIONS\n",
    "# ============================================================================\n",
    "drug_drug_high = [a for a in drug_drug_alerts if a['severity'] == 'HIGH']\n",
    "drug_drug_medium = [a for a in drug_drug_alerts if a['severity'] == 'MEDIUM']\n",
    "drug_drug_low = [a for a in drug_drug_alerts if a['severity'] == 'LOW']\n",
    "\n",
    "print(\"=\" * 80)\n",
    "print(\"‚ö†Ô∏è  DANGEROUS DRUG COMBINATIONS DETECTED\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if len(drug_drug_alerts) > 0:\n",
    "    if len(drug_drug_high) > 0:\n",
    "        print(f\"\\nüö® HIGH RISK COMBINATIONS ({len(drug_drug_high)}) - IMMEDIATE ACTION REQUIRED:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(drug_drug_high, 1):\n",
    "            drugs = \" + \".join(alert['drugs'])\n",
    "            print(f\"\\n{idx}. ‚ùå DO NOT USE TOGETHER: {drugs}\")\n",
    "            print(f\"   Reason: {alert['risk']}\")\n",
    "            print(f\"   Action: Consult physician to adjust medication immediately\")\n",
    "    \n",
    "    if len(drug_drug_medium) > 0:\n",
    "        print(f\"\\n‚ö†Ô∏è  MEDIUM RISK COMBINATIONS ({len(drug_drug_medium)}) - MONITOR CLOSELY:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(drug_drug_medium, 1):\n",
    "            drugs = \" + \".join(alert['drugs'])\n",
    "            print(f\"\\n{idx}. ‚ö†Ô∏è  USE WITH CAUTION: {drugs}\")\n",
    "            print(f\"   Reason: {alert['risk']}\")\n",
    "            print(f\"   Action: Monitor patient for adverse effects\")\n",
    "    \n",
    "    if len(drug_drug_low) > 0:\n",
    "        print(f\"\\n‚ÑπÔ∏è  LOW RISK COMBINATIONS ({len(drug_drug_low)}) - AWARENESS NEEDED:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(drug_drug_low, 1):\n",
    "            drugs = \" + \".join(alert['drugs'])\n",
    "            print(f\"{idx}. {drugs} - {alert['risk']}\")\n",
    "else:\n",
    "    print(\"‚úì No drug-drug interactions detected\")\n",
    "    print(\"  Current medications are safe to use together\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 4: DISEASE-DRUG CONTRAINDICATIONS\n",
    "# ============================================================================\n",
    "disease_drug_high = [a for a in disease_drug_alerts if a['severity'] == 'HIGH']\n",
    "disease_drug_medium = [a for a in disease_drug_alerts if a['severity'] == 'MEDIUM']\n",
    "disease_drug_low = [a for a in disease_drug_alerts if a['severity'] == 'LOW']\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"‚ö†Ô∏è  DISEASE-DRUG CONTRAINDICATIONS\")\n",
    "print(\"=\" * 80)\n",
    "print(\"These drugs should be AVOIDED or closely monitored given patient's conditions:\\n\")\n",
    "\n",
    "if len(disease_drug_alerts) > 0:\n",
    "    if len(disease_drug_high) > 0:\n",
    "        print(f\"üö® HIGH RISK ({len(disease_drug_high)}) - STRONGLY CONTRAINDICATED:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(disease_drug_high, 1):\n",
    "            print(f\"\\n{idx}. ‚ùå {alert['drug'].upper()} - Contraindicated for {alert['condition']}\")\n",
    "            print(f\"   Warning: {alert['warning']}\")\n",
    "            print(f\"   Action: Consider alternative medication\")\n",
    "    \n",
    "    if len(disease_drug_medium) > 0:\n",
    "        print(f\"\\n‚ö†Ô∏è  MEDIUM RISK ({len(disease_drug_medium)}) - USE WITH CAUTION:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(disease_drug_medium, 1):\n",
    "            print(f\"\\n{idx}. ‚ö†Ô∏è  {alert['drug']} - Risk for {alert['condition']} patients\")\n",
    "            print(f\"   Warning: {alert['warning']}\")\n",
    "            print(f\"   Action: Monitor patient closely, adjust dosage if needed\")\n",
    "    \n",
    "    if len(disease_drug_low) > 0:\n",
    "        print(f\"\\n‚ÑπÔ∏è  LOW RISK ({len(disease_drug_low)}) - MONITOR:\")\n",
    "        print(\"-\" * 80)\n",
    "        for idx, alert in enumerate(disease_drug_low, 1):\n",
    "            print(f\"{idx}. {alert['drug']} + {alert['condition']}: {alert['warning']}\")\n",
    "else:\n",
    "    print(\"‚úì No disease-drug contraindications detected\")\n",
    "    print(\"  Current medications are appropriate for patient's conditions\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 5: FINAL CLINICAL RECOMMENDATION\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"‚ñà\" * 80)\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 23 + \"FINAL RECOMMENDATION\" + \" \" * 35 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" * 80 + \"\\n\")\n",
    "\n",
    "print(f\"Overall Risk Level: {overall_risk}\")\n",
    "print(f\"Total Safety Alerts: {len(all_alerts)}\")\n",
    "print(f\"  - Drug-Drug Interactions: {len(drug_drug_alerts)}\")\n",
    "print(f\"  - Disease-Drug Contraindications: {len(disease_drug_alerts)}\")\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"CLINICAL ACTION REQUIRED:\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if overall_risk == \"HIGH\":\n",
    "    print(\"üö® URGENT: HIGH RISK DETECTED\")\n",
    "    print(\"   ‚û§ Immediate physician consultation required\")\n",
    "    print(\"   ‚û§ Do NOT proceed with current medication regimen without review\")\n",
    "    print(\"   ‚û§ Consider alternative drugs or dosage adjustments\")\n",
    "    print(\"   ‚û§ Monitor patient for adverse effects\")\n",
    "elif overall_risk == \"MEDIUM\":\n",
    "    print(\"‚ö†Ô∏è  CAUTION: MEDIUM RISK DETECTED\")\n",
    "    print(\"   ‚û§ Schedule physician consultation soon\")\n",
    "    print(\"   ‚û§ Monitor patient closely for side effects\")\n",
    "    print(\"   ‚û§ Consider dosage adjustments or timing changes\")\n",
    "    print(\"   ‚û§ Patient education on warning signs\")\n",
    "elif overall_risk == \"LOW\":\n",
    "    print(\"‚ÑπÔ∏è  ADVISORY: LOW RISK DETECTED\")\n",
    "    print(\"   ‚û§ Continue current regimen with routine monitoring\")\n",
    "    print(\"   ‚û§ Patient should be aware of potential minor interactions\")\n",
    "    print(\"   ‚û§ Report any unusual symptoms\")\n",
    "else:\n",
    "    print(\"‚úì SAFE: No safety concerns detected\")\n",
    "    print(\"   ‚û§ Current medication regimen is safe\")\n",
    "    print(\"   ‚û§ Continue as prescribed\")\n",
    "    print(\"   ‚û§ Routine follow-up recommended\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 6: MEDICATIONS SUMMARY (Detailed)\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"MEDICATIONS SUMMARY (DETAILED):\")\n",
    "print(\"=\" * 80)\n",
    "if len(drugs_list) > 0:\n",
    "    print(f\"Total Active Medications: {len(drugs_list)}\\n\")\n",
    "    for idx, drug in enumerate(drugs_list, 1):\n",
    "        # Check if this drug has any alerts\n",
    "        has_interaction = any(drug in alert.get('drugs', []) for alert in drug_drug_alerts)\n",
    "        has_contraindication = any(drug == alert.get('drug', '') for alert in disease_drug_alerts)\n",
    "        \n",
    "        marker = \"\"\n",
    "        risk_level = \"SAFE\"\n",
    "        if has_interaction and has_contraindication:\n",
    "            marker = \" ‚ö†Ô∏è‚ö†Ô∏è (MULTIPLE RISKS)\"\n",
    "            risk_level = \"HIGH RISK\"\n",
    "        elif has_interaction:\n",
    "            marker = \" ‚ö†Ô∏è (INTERACTION RISK)\"\n",
    "            risk_level = \"CAUTION\"\n",
    "        elif has_contraindication:\n",
    "            marker = \" ‚ö†Ô∏è (CONTRAINDICATION)\"\n",
    "            risk_level = \"CAUTION\"\n",
    "        else:\n",
    "            marker = \" ‚úì\"\n",
    "            risk_level = \"SAFE\"\n",
    "        \n",
    "        print(f\"  {idx}. {drug}{marker}\")\n",
    "        \n",
    "        # Get detailed prescription information if available\n",
    "        if 'patient_prescriptions' in globals() and not patient_prescriptions.empty:\n",
    "            rx_details = patient_prescriptions[patient_prescriptions['drug'].str.lower() == drug.lower()]\n",
    "            if not rx_details.empty:\n",
    "                for _, rx_row in rx_details.iterrows():\n",
    "                    print(f\"     Dosage: {rx_row['dose']}\")\n",
    "                    print(f\"     Frequency: {rx_row['frequency']}\")\n",
    "                    print(f\"     Prescribed: {rx_row['start_date']}\")\n",
    "                    print(f\"     Status: {rx_row['status']}\")\n",
    "                    print(f\"     Safety Assessment: {risk_level}\")\n",
    "                    \n",
    "                    # Show specific risks for this drug\n",
    "                    if has_interaction:\n",
    "                        interacting_drugs = []\n",
    "                        for alert in drug_drug_alerts:\n",
    "                            if drug in alert.get('drugs', []):\n",
    "                                other_drug = [d for d in alert['drugs'] if d != drug]\n",
    "                                if other_drug:\n",
    "                                    interacting_drugs.append(f\"{other_drug[0]} ({alert['severity']})\")\n",
    "                        if interacting_drugs:\n",
    "                            print(f\"     ‚ö†Ô∏è  Interactions with: {', '.join(interacting_drugs)}\")\n",
    "                    \n",
    "                    if has_contraindication:\n",
    "                        contraindicated_conditions = []\n",
    "                        for alert in disease_drug_alerts:\n",
    "                            if drug == alert.get('drug', ''):\n",
    "                                contraindicated_conditions.append(f\"{alert['condition']} ({alert['severity']})\")\n",
    "                        if contraindicated_conditions:\n",
    "                            print(f\"     ‚ö†Ô∏è  Contraindicated for: {', '.join(contraindicated_conditions)}\")\n",
    "        print()\n",
    "else:\n",
    "    print(\"  No current medications\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 7: CONDITIONS SUMMARY (Detailed)\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"CONDITIONS SUMMARY (DETAILED):\")\n",
    "print(\"=\" * 80)\n",
    "if len(conditions_list) > 0:\n",
    "    print(f\"Total Active Conditions: {len(conditions_list)}\\n\")\n",
    "    for idx, condition in enumerate(conditions_list, 1):\n",
    "        print(f\"  {idx}. {condition}\")\n",
    "        \n",
    "        # Get detailed condition information if available\n",
    "        if 'patient_conditions' in globals() and not patient_conditions.empty:\n",
    "            cond_details = patient_conditions[patient_conditions['condition'].str.lower() == condition.lower()]\n",
    "            if not cond_details.empty:\n",
    "                for _, c_row in cond_details.iterrows():\n",
    "                    print(f\"     Status: {c_row['status']}\")\n",
    "                    print(f\"     Since: {c_row['since']}\")\n",
    "                    print(f\"     Chronic: {c_row['chronic']}\")\n",
    "                    \n",
    "                    # Show which medications are affected by this condition\n",
    "                    affected_drugs = []\n",
    "                    for alert in disease_drug_alerts:\n",
    "                        if condition.lower() == alert.get('condition', '').lower():\n",
    "                            affected_drugs.append(f\"{alert['drug']} ({alert['severity']} risk)\")\n",
    "                    \n",
    "                    if affected_drugs:\n",
    "                        print(f\"     ‚ö†Ô∏è  Affects medications: {', '.join(affected_drugs)}\")\n",
    "        print()\n",
    "else:\n",
    "    print(\"  No documented conditions\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 8: LAB REPORTS\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"LABORATORY REPORTS:\")\n",
    "print(\"=\" * 80)\n",
    "if 'patient_info' in globals() and not patient_info.empty:\n",
    "    abha = patient_info.iloc[0]['abha_id']\n",
    "    patient_labs = lab_reports_df[lab_reports_df['abha_id'] == abha]\n",
    "    \n",
    "    if not patient_labs.empty:\n",
    "        print(f\"Total Lab Tests on Record: {len(patient_labs)}\\n\")\n",
    "        for idx, (_, lab) in enumerate(patient_labs.iterrows(), 1):\n",
    "            print(f\"  {idx}. {lab['test_name']}\")\n",
    "            print(f\"     Result: {lab['result']} {lab['unit']}\")\n",
    "            print(f\"     Reference Range: {lab['normal_range']}\")\n",
    "            print(f\"     Test Date: {lab['test_date']}\")\n",
    "            \n",
    "            # Flag abnormal results\n",
    "            try:\n",
    "                result_val = float(lab['result'])\n",
    "                range_parts = lab['normal_range'].split('-')\n",
    "                if len(range_parts) == 2:\n",
    "                    lower = float(range_parts[0])\n",
    "                    upper = float(range_parts[1])\n",
    "                    if result_val < lower:\n",
    "                        print(f\"     ‚ö†Ô∏è  STATUS: BELOW NORMAL - Monitor closely\")\n",
    "                    elif result_val > upper:\n",
    "                        print(f\"     ‚ö†Ô∏è  STATUS: ABOVE NORMAL - Monitor closely\")\n",
    "                    else:\n",
    "                        print(f\"     ‚úì STATUS: Within normal range\")\n",
    "            except:\n",
    "                print(f\"     STATUS: Review required\")\n",
    "            print()\n",
    "    else:\n",
    "        print(\"  No recent lab reports on file\")\n",
    "        print(\"  Recommendation: Order baseline labs for medication monitoring\")\n",
    "else:\n",
    "    print(\"  Lab data not available for custom test data\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 9: RISK MITIGATION STRATEGIES\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"RISK MITIGATION STRATEGIES:\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if overall_risk in [\"HIGH\", \"MEDIUM\"]:\n",
    "    print(\"\\nRECOMMENDED ACTIONS TO REDUCE RISK:\\n\")\n",
    "    \n",
    "    # Specific recommendations based on alerts\n",
    "    recommendations = []\n",
    "    \n",
    "    for alert in drug_drug_alerts:\n",
    "        if alert['severity'] == 'HIGH':\n",
    "            drugs = ' + '.join(alert['drugs'])\n",
    "            recommendations.append(f\"‚Ä¢ Discontinue or replace one of: {drugs}\")\n",
    "            recommendations.append(f\"  Alternative: Consult pharmacist for substitute medication\")\n",
    "    \n",
    "    for alert in disease_drug_alerts:\n",
    "        if alert['severity'] == 'HIGH':\n",
    "            recommendations.append(f\"‚Ä¢ Replace {alert['drug']} due to {alert['condition']}\")\n",
    "            recommendations.append(f\"  Reason: {alert['warning']}\")\n",
    "    \n",
    "    if len(drug_drug_alerts) > 0:\n",
    "        recommendations.append(f\"‚Ä¢ Consider staggered dosing schedules to minimize interactions\")\n",
    "        recommendations.append(f\"‚Ä¢ Monitor vital signs more frequently (daily if HIGH risk)\")\n",
    "    \n",
    "    if len(disease_drug_alerts) > 0:\n",
    "        recommendations.append(f\"‚Ä¢ Schedule follow-up labs to monitor organ function\")\n",
    "        recommendations.append(f\"‚Ä¢ Patient education on warning signs and symptoms\")\n",
    "    \n",
    "    for rec in recommendations:\n",
    "        print(rec)\n",
    "else:\n",
    "    print(\"\\n‚úì Current regimen is appropriate\")\n",
    "    print(\"  Continue routine monitoring and follow-up\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 10: FOLLOW-UP RECOMMENDATIONS\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"FOLLOW-UP RECOMMENDATIONS:\")\n",
    "print(\"=\" * 80)\n",
    "\n",
    "if overall_risk == \"HIGH\":\n",
    "    print(\"\\nüö® URGENT FOLLOW-UP REQUIRED:\")\n",
    "    print(\"  ‚Ä¢ Schedule physician consultation within 24-48 hours\")\n",
    "    print(\"  ‚Ä¢ Do NOT wait for next scheduled appointment\")\n",
    "    print(\"  ‚Ä¢ Consider emergency department if symptoms worsen\")\n",
    "    print(\"  ‚Ä¢ Daily medication review until risk is mitigated\")\n",
    "elif overall_risk == \"MEDIUM\":\n",
    "    print(\"\\n‚ö†Ô∏è  FOLLOW-UP NEEDED:\")\n",
    "    print(\"  ‚Ä¢ Schedule physician consultation within 1 week\")\n",
    "    print(\"  ‚Ä¢ Monitor patient daily for adverse effects\")\n",
    "    print(\"  ‚Ä¢ Weekly medication review recommended\")\n",
    "    print(\"  ‚Ä¢ Patient should report any new symptoms immediately\")\n",
    "elif overall_risk == \"LOW\":\n",
    "    print(\"\\n‚ÑπÔ∏è  ROUTINE FOLLOW-UP:\")\n",
    "    print(\"  ‚Ä¢ Continue scheduled appointments\")\n",
    "    print(\"  ‚Ä¢ Monitor for any changes in condition\")\n",
    "    print(\"  ‚Ä¢ Monthly medication review recommended\")\n",
    "    print(\"  ‚Ä¢ Report any unusual symptoms\")\n",
    "else:\n",
    "    print(\"\\n‚úì STANDARD FOLLOW-UP:\")\n",
    "    print(\"  ‚Ä¢ Continue routine scheduled appointments\")\n",
    "    print(\"  ‚Ä¢ Annual medication review\")\n",
    "    print(\"  ‚Ä¢ Contact physician if any concerns arise\")\n",
    "\n",
    "# ============================================================================\n",
    "# SECTION 11: PATIENT EDUCATION POINTS\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"PATIENT EDUCATION POINTS:\")\n",
    "print(\"=\" * 80)\n",
    "print(\"\\nWhat the patient should know:\\n\")\n",
    "print(f\"1. You are currently taking {len(drugs_list)} medication(s)\")\n",
    "print(f\"2. You have {len(conditions_list)} condition(s) being managed\")\n",
    "print(f\"3. You have {len(allergies_list)} known allergy/allergies on file\")\n",
    "print(f\"4. Your current risk level is: {overall_risk}\")\n",
    "\n",
    "if len(all_alerts) > 0:\n",
    "    print(f\"\\n5. Important Safety Information:\")\n",
    "    print(f\"   ‚Ä¢ There are {len(all_alerts)} potential safety concern(s)\")\n",
    "    print(f\"   ‚Ä¢ Do NOT start any new medications without consulting your doctor\")\n",
    "    print(f\"   ‚Ä¢ Do NOT stop current medications without medical advice\")\n",
    "    print(f\"   ‚Ä¢ Report these symptoms immediately:\")\n",
    "    \n",
    "    symptoms_to_watch = set()\n",
    "    for alert in drug_drug_alerts:\n",
    "        if 'bleeding' in alert['risk'].lower():\n",
    "            symptoms_to_watch.add(\"     - Unusual bleeding or bruising\")\n",
    "        if 'kidney' in alert['risk'].lower():\n",
    "            symptoms_to_watch.add(\"     - Decreased urination or swelling\")\n",
    "        if 'liver' in alert['risk'].lower():\n",
    "            symptoms_to_watch.add(\"     - Yellowing of skin or eyes\")\n",
    "    \n",
    "    for symptom in symptoms_to_watch:\n",
    "        print(symptom)\n",
    "    \n",
    "    if not symptoms_to_watch:\n",
    "        print(\"     - Any unusual or new symptoms\")\n",
    "        print(\"     - Worsening of existing conditions\")\n",
    "        print(\"     - Side effects from medications\")\n",
    "\n",
    "# ============================================================================\n",
    "# END OF REPORT\n",
    "# ============================================================================\n",
    "print(\"\\n\" + \"‚ñà\" * 80)\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 30 + \"END OF REPORT\" + \" \" * 36 + \"‚ñà\")\n",
    "print(\"‚ñà\" + \" \" * 78 + \"‚ñà\")\n",
    "print(\"‚ñà\" * 80)\n",
    "\n",
    "print(\"\\n\" + \"=\" * 80)\n",
    "print(\"REPORT METADATA\")\n",
    "print(\"=\" * 80)\n",
    "print(f\"‚úì LifeLine AI Clinical Decision Support Analysis Complete\")\n",
    "print(f\"  Report Generated: {pd.Timestamp.now().strftime('%Y-%m-%d %H:%M:%S')}\")\n",
    "print(f\"  AI Model: d4data/biomedical-ner-all (Hugging Face)\")\n",
    "print(f\"  Rule Engine: drug_interactions.csv + disease_contra.csv\")\n",
    "print(f\"  Total Entities Extracted: {len(extracted_drugs)} drugs, {len(extracted_diseases)} diseases\")\n",
    "print(f\"  Total Safety Rules Checked: {len(drug_interactions_df) + len(disease_contra_df)}\")\n",
    "print(f\"  Analysis Method: AI-assisted entity extraction + Rule-based safety validation\")\n",
    "print(\"=\" * 80)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
